<div class="configuration-page">
  <div class="header-container">
    <div class="title">Make your model configuration:</div>
    <app-sidebard></app-sidebard>
  </div>
  <div class="main-container">
    <div class="configuration-page_left-content">
      <app-direction
        [recreateActionsButton]="recreatingSimulation"
        [lastKeyPressed]="lastKeyPressed"
      ></app-direction>
      <div class="board-container">
        <div
          class="board"
          tabindex="0"
          [style.width.px]="
            ['0', '00', ''].includes(recording.board_width.toString())
              ? 800
              : recording.board_width
          "
          [style.height.px]="
            ['0', '00', ''].includes(recording.board_height.toString())
              ? 600
              : recording.board_height
          "
          (click)="customizeBoard($event)"
        >
          <div
            class="robot"
            [style.left.px]="currentPosition.x"
            [style.top.px]="currentPosition.y"
          ></div>
          <div
            *ngIf="
              recording.robot_finish.x !== 0 && recording.robot_finish.y !== 0
            "
            class="finish-point"
            [style.left.px]="recording.robot_finish.x"
            [style.top.px]="recording.robot_finish.y"
            (click)="handleFinishPointClick($event)"
          ></div>
          <div
            *ngFor="let obstacle of obstacles"
            class="obstacle"
            [style.left.px]="obstacle.pos.x"
            [style.top.px]="obstacle.pos.y"
            [style.width.px]="obstacle.width"
            [style.height.px]="obstacle.height"
            (click)="handleObstacleClick($event, obstacle)"
          ></div>

          <div
            class="robot-trace"
            [style.left.px]="recording.robot_start.x"
            [style.top.px]="recording.robot_start.y"
          ></div>

          <div
            class="robot-trace"
            *ngFor="let trace of robotTrace"
            [style.left.px]="trace.x"
            [style.top.px]="trace.y"
          ></div>
        </div>
      </div>
    </div>
    <div *ngIf="step !== 0" class="configuration-page_right-content">
      <!-- MESSAGES -->
      <app-step-messages [step]="step"></app-step-messages>

      <!-- OPTIONS FOR EVERY STEP -->
      <form class="form-container">
        <!-- BOARD SETTINGS -->
        <mat-form-field *ngIf="step === 1" class="right-container_form-field">
          <mat-label>Room width (cm)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="recording.board_width"
            name="boardWidth"
          />
        </mat-form-field>
        <mat-form-field *ngIf="step === 1" class="right-container_form-field">
          <mat-label>Room height (cm)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="recording.board_height"
            name="boardHeight"
          />
        </mat-form-field>

        <!-- ROBOT SETTINGS -->
        <mat-form-field *ngIf="step === 2" class="right-container_form-field">
          <mat-label>Step used by the robot to move (cm)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="recording.robot_step"
            name="stepValue"
          />
        </mat-form-field>
        <button
          *ngIf="step === 2"
          mat-raised-button
          class="form-field-button"
          (click)="chooseStartingPoint()"
        >
          Choose starting point for robot
        </button>
        <button
          *ngIf="step === 2"
          mat-raised-button
          class="form-field-button"
          (click)="chooseFinishPoint()"
        >
          Choose finish point for robot
        </button>

        <!-- OBSTACLES SETTINGS -->
        <mat-form-field *ngIf="step === 3" class="right-container_form-field">
          <mat-label>Obstacle width (cm)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="obstacleWidth"
            name="obstacleWidth"
          />
        </mat-form-field>
        <mat-form-field *ngIf="step === 3" class="right-container_form-field">
          <mat-label>Obstacle height (cm)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="obstacleHeight"
            name="obstacleHeight"
          />
        </mat-form-field>

        <!-- TRAIN MODEL BUTTONS -->
        <button
          *ngIf="step === 4"
          mat-raised-button
          class="form-field-button"
          [disabled]="recreateSimulationButton"
          (click)="startSimulation()"
        >
          Start simulation
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          class="form-field-button"
          [disabled]="!stopSimulationButton"
          (click)="stopSimulation()"
        >
          Stop simulation
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          [disabled]="!recreateSimulationButton"
          class="form-field-button"
          (click)="recreateSimulation()"
        >
          Recreate simulation
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          [disabled]="!tryAgainButton || recreatingSimulation"
          class="form-field-button"
          (click)="tryAgain()"
        >
          Try again
        </button>

        <!-- RECORDING CONFIGURATION -->
        <mat-form-field *ngIf="step === 5" class="right-container_form-field">
          <mat-label>Configuration time (s)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="recording.configuration_time"
            name="confTime"
          />
        </mat-form-field>
        <mat-form-field *ngIf="step === 5" class="right-container_form-field">
          <mat-label>Performance percentage (%)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="recording.performance"
            name="performance"
          />
        </mat-form-field>
      </form>

      <!-- OPTIONS BUTTONS -->
      <button
        *ngIf="step !== 0"
        mat-button
        color="accent"
        class="back-to-steps-button"
        (click)="
          applyChanges(
            recording.board_width,
            recording.board_height,
            obstacleWidth,
            obstacleHeight,
            recording.robot_step,
            recording.configuration_time,
            recording.performance
          )
        "
      >
        Back to steps
      </button>
    </div>

    <!-- STEP BUTTONS -->
    <div *ngIf="step === 0" class="step-buttons">
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="boardSettings()"
      >
        STEP 1: Board settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="robotSettings()"
      >
        STEP 2: Robot settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="obstaclesSettings()"
      >
        STEP 3: Obstacles settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="simulation()"
      >
        STEP 4: Simulation
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="configurationSettings()"
      >
        STEP 5: Recording configuration
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="goTrainModel()"
      >
        STEP 6: Go train model
      </button>
    </div>
  </div>
</div>
