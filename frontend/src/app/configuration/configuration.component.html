<div class="configuration-page">
  <div class="configuration-page_title">Train the new model here:</div>

  <div class="configuration-page_content">
    <div class="configuration-page_left-content">
      <app-direction
        [recreateActionsButton]="recreateActionsButton"
        [lastKeyPressed]="lastKeyPressed"
      ></app-direction>
      <div class="board-container">
        <div
          class="board"
          tabindex="0"
          [style.width.px]="
            ['0', '00', ''].includes(boardWidth) ? '800' : boardWidth
          "
          [style.height.px]="
            ['0', '00', ''].includes(boardHeight) ? '600' : boardHeight
          "
          (click)="customizeBoard($event)"
        >
          <div
            class="robot"
            [style.left.px]="startPoint.x"
            [style.top.px]="startPoint.y"
          ></div>
          <div
            *ngIf="finishPoint.x !== 0 && finishPoint.y !== 0"
            class="finish-point"
            [style.left.px]="finishPoint.x"
            [style.top.px]="finishPoint.y"
          ></div>
          <div
            *ngFor="let obstacle of obstacles"
            class="obstacle"
            [style.left.px]="obstacle.x"
            [style.top.px]="obstacle.y"
            [style.width.px]="obstacle.width"
            [style.height.px]="obstacle.height"
            (click)="handleObstacleClick($event, obstacle)"
          ></div>
        </div>
      </div>
    </div>
    <div *ngIf="step !== 0" class="configuration-page_right-content">
      <!-- MESSAGES -->
      <app-step-messages [step]="step"></app-step-messages>

      <!-- OPTIONS FOR EVERY STEP -->
      <form class="form-container">
        <!-- BOARD SETTINGS -->
        <mat-form-field *ngIf="step === 1" class="right-container_form-field">
          <mat-label>Board width (px)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="boardWidth"
            name="boardWidth"
          />
        </mat-form-field>
        <mat-form-field *ngIf="step === 1" class="right-container_form-field">
          <mat-label>Board height (px)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="boardHeight"
            name="boardHeight"
          />
        </mat-form-field>

        <!-- ROBOT SETTINGS -->
        <mat-form-field *ngIf="step === 2" class="right-container_form-field">
          <mat-label>Step used by the robot to move</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="stepValue"
            name="stepValue"
          />
        </mat-form-field>
        <button
          *ngIf="step === 2"
          mat-raised-button
          class="form-field-button"
          [disabled]="chooseFinishPointActive"
          (click)="chooseStartingPoint()"
        >
          Choose starting point for robot
        </button>
        <button
          *ngIf="step === 2"
          mat-raised-button
          class="form-field-button"
          [disabled]="!afterChoosingStartingPoint"
          (click)="chooseFinishPoint()"
        >
          Choose finish point for robot
        </button>

        <!-- OBSTACLES SETTINGS -->
        <mat-form-field *ngIf="step === 3" class="right-container_form-field">
          <mat-label>Obstacle width (px)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="obstacleWidth"
            name="obstacleWidth"
          />
        </mat-form-field>
        <mat-form-field *ngIf="step === 3" class="right-container_form-field">
          <mat-label>Obstacle height (px)</mat-label>
          <input
            matInput
            type="text"
            [(ngModel)]="obstacleHeight"
            name="obstacleHeight"
          />
        </mat-form-field>

        <!-- TRAIN MODEL BUTTONS -->
        <button
          *ngIf="step === 4"
          mat-raised-button
          class="form-field-button"
          [disabled]="recreateActionsButton"
          (click)="startRecord()"
        >
          Start record
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          class="form-field-button"
          [disabled]="!stopRecordButton"
          (click)="stopRecord()"
        >
          Stop record
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          [disabled]="!recreateActionsButton"
          class="form-field-button"
          (click)="recreateActions()"
        >
          Recreate actions
        </button>
        <button
          *ngIf="step === 4"
          mat-raised-button
          [disabled]="!recreateActionsButton"
          class="form-field-button"
          (click)="tryAgain()"
        >
          Try again
        </button>
      </form>

      <!-- OPTIONS BUTTONS -->
      <div class="options-buttons">
        <button
          *ngIf="step !== 0"
          mat-raised-button
          color="warn"
          (click)="
            applyChanges(
              boardWidth,
              boardHeight,
              obstacleWidth,
              obstacleHeight,
              stepValue
            )
          "
        >
          Back to steps
        </button>
        <button
          *ngIf="step === 2"
          mat-raised-button
          color="warn"
          (click)="resetPositions()"
        >
          Reset
        </button>
      </div>
    </div>

    <!-- STEP BUTTONS -->
    <div *ngIf="step === 0" class="step-buttons">
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="boardSettings()"
      >
        STEP 1: Board settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="robotSettings()"
      >
        STEP 2: Robot settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="obstaclesSettings()"
      >
        STEP 3: Obstacles settings
      </button>
      <button
        mat-raised-button
        color="accent"
        class="configuration_button"
        (click)="trainModel()"
      >
        STEP 4: Train model
      </button>
    </div>
  </div>
</div>
